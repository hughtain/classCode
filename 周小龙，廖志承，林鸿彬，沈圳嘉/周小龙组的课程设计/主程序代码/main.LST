C51 COMPILER V9.00   MAIN                                                                  03/07/2016 00:05:53 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg52.h>
   2          #include <intrins.h>
   3          #include <absacc.h>               //Õ∑Œƒº˛
   4          #define uint unsigned int
   5          #define uchar unsigned char       //∫Í∂®“Â
   6          
   7          //∞¥º¸
   8          sbit key1=P3^2;    //≤º∑¿
   9          sbit key2=P3^3;    //≥∑∑¿
  10          sbit key3=P3^4;    //ΩÙº±±®æØ
  11          
  12          sbit BUZZ=P0^4;    //∑‰√˘∆˜
  13          sbit rsd=P2^4;     //»» ÕµÁ ‰»Î
  14          sbit LED_B=P2^3;   //≤º∑¿÷∏ æµ∆
  15          sbit LED_S=P2^0;   //∑¢ÀÕœ˚œ¢÷∏ æµ∆
  16          
  17          uchar code PhoneNO[]            ="15046397767"; //Ω” ‹∫≈¬Î
  18          
  19          uchar code somebody[]           ="8BF76CE8610FFF0167094EBA8FDB516562A58B66830356F4FF01";        //«Î◊¢“‚£°”–»ÀΩ¯»Î±®æØ∑∂Œß
             -£°                                                                                                  
  20          
  21          uint TIME_50ms=0;          //º∆ ±µƒ◊Ó–°∑÷±Ê¬ 50ms
  22          uint time_continue;        //∑‰√˘∆˜√˘œÏ ±º∆ ± ˝æ›‘›¥Ê
  23          bit flag=0,flag_BF=0;  //flag£∫÷µŒ™0 ±£¨ «≤º∑¿º∆ ±ƒ£ Ω£¨÷µŒ™1 ±£¨ «“ª∑÷÷”µ»¥˝ƒ£ Ω°£flag_BF£∫≤º∑¿±Í÷æŒª
  24          bit flag_time_start=0; //ø™ ºº∆ ±±Í÷æŒª
  25          bit again=0;               //“ª∑÷÷”µ»¥˝±Í÷æŒª£®µ±∑¢ÀÕ“ªÃı∂Ã–≈∫Û£¨≤ªƒ‹¬Ì…œ∑¢ÀÕµ⁄∂˛ÃÏ£¨À˘“‘µ»¥˝“ª∑÷÷”∫Û‘ŸºÏ≤‚ «∑Ò”–»À£
             -¨”–»À‘Ÿ∑¢ÀÕ∂Ã–≈£©
  26          bit flag_alam;             //±®æØ±Í÷æŒª
  27          bit SOS;                           //∑¢ÀÕ∂Ã–≈ ± «∑Ò «∞¥œ¬ΩÙº±∞¥º¸
  28          bit flag_continue;         //ºÃ–¯º∆ ±
  29          bit into_BF=0;
  30          
  31          void delay(uint z)//—” ±∫Ø ˝
  32          {
  33   1              uint x,y;
  34   1              for(x=z;x>0;x--)
  35   1              for(y=110;y>0;y--);
  36   1      }
  37          
  38          void Uart_init()
  39          {
  40   1              TMOD= 0X20;             //T1  ∑Ω Ω2  £¨8Œª   ◊‘∂Ø÷ÿ◊∞   
  41   1              TH1=0Xfd;
  42   1              TL1=0Xfd;           //9600≤®Ãÿ¬ 
  43   1              TR1=1;              // ∂® ±∆˜1∆Ù∂Ø  
  44   1              SM0=0;      // …Ë÷√¥Æø⁄µƒπ§◊˜ƒ£ Ω
  45   1              SM1=1;      //∑Ω Ω1
  46   1      
  47   1              REN=0;           // ‘ –Ì¥Æø⁄Ω” ’ ˝æ›     
  48   1      
  49   1              ES=0;        // ¥Æø⁄÷–∂œ”¶–Ì 
  50   1              EA=1;            // ø™∆Ù÷–∂œ 
  51   1      }
  52          
  53          void SendASC(uchar d)   //¥Æø⁄∑¢ÀÕ◊÷∑˚
C51 COMPILER V9.00   MAIN                                                                  03/07/2016 00:05:53 PAGE 2   

  54          {
  55   1              
  56   1              SBUF=d;                         // ˝æ›∏≥÷µµΩª∫≥Â«¯
  57   1              while(!TI);                     //∑¢ÀÕÕÍ
  58   1      
  59   1              TI=0;                           //«Â¡„
  60   1      }
  61          
  62          void SendString(uchar *str)       //¥Æø⁄∑¢ÀÕ◊÷∑˚¥Æ
  63          {
  64   1              while(*str)                               //≈–∂œ «∑Ò∑¢ÀÕÕÍ
  65   1              {
  66   2                      SendASC(*str) ;           //∑¢ÀÕ◊÷∑˚
  67   2                      str++;                            //◊÷∑˚Œª÷√º”
  68   2                      //delay_uart(1);
  69   2              }
  70   1      }
  71          
  72          void TIME()                                             //º∆ ±∫Ø ˝
  73          {
  74   1              if(flag==0)                                     //≤º∑¿º∆ ±ƒ£ Ω
  75   1              {
  76   2                      delay(50);                              //50ms
  77   2                      TIME_50ms++;                    //50ms±‰¡øº”1
  78   2                      if(TIME_50ms%10==0)             //√ø500ms£®50ms*10£©
  79   2                      LED_B=!LED_B;                   //≤º∑¿÷∏ æµ∆»°∑¥“ª¥Œ
  80   2                      
  81   2                      if(TIME_50ms>=400)              //º”µΩ400¥Œ£¨“≤æÕ «50ms*400=20000ms=20s
  82   2                      {
  83   3                              TIME_50ms=0;            //º∆ ±±‰¡ø«Â¡„
  84   3                              flag_BF=1;                      //Ω¯»Î≤º∑¿◊¥Ã¨
  85   3                              LED_B=0;                        //≤º∑¿÷∏ æµ∆≥§¡¡
  86   3                              flag_time_start=0;      //Õ£÷πº∆ ±
  87   3                              again=1;                        //πÿ±’“ª∑÷÷”µ»¥˝
  88   3                      }       
  89   2              }
  90   1              else                                            //“ª∑÷÷”µ»¥˝ƒ£ Ω
  91   1              {
  92   2                      delay(50);                              //50ms
  93   2                      TIME_50ms++;                    //±‰¡øº”
  94   2                      if(TIME_50ms%10==0)             //√øº”500ms
  95   2                      {
  96   3                              LED_B=!LED_B;           //≤º∑¿÷∏ æµ∆…¡À∏
  97   3                              if(flag_alam==1)        //±®æØ
  98   3                              {
  99   4                                      if(flag_continue==0)//Ω¯»Î±®æØ ±
 100   4                                      {
 101   5                                              flag_continue=1;//¥À±Í÷æŒª÷√“ª£¨∑¿÷π±®æØ ±Ω¯»Î
 102   5                                              time_continue=TIME_50ms; //Ω´Ω¯»Î±®æØ ±µƒº∆ ± ˝æ›‘›¥Ê
 103   5                                      }
 104   4                                      BUZZ=!BUZZ;             //∑‰√˘∆˜»°∑¥£¨“≤æÕ «…¡À∏œÏ
 105   4                                      if(TIME_50ms>=time_continue+100)//µ±±®æØ ±º‰¥ÔµΩ5s ±
 106   4                                      {
 107   5                                              BUZZ=1;                                         //πÿ±’∑‰√˘∆˜
 108   5                                              flag_continue=0;                        //±Í÷æŒª«Â¡„£¨µ»¥˝œ¬¥Œ±®æØ
 109   5                                              flag_alam=0;                            //±®æØ±‰¡ø«Â¡„£¨Õ£÷π±®æØ
 110   5                                              time_continue=0;                        //‘›¥Êº∆ ± ˝æ›«Â¡„
 111   5                                      }       
 112   4                              }
 113   3                      }
 114   2                      if(TIME_50ms>=1200)                //º∆ ±¥ÔµΩ60√Î
 115   2                      {
C51 COMPILER V9.00   MAIN                                                                  03/07/2016 00:05:53 PAGE 3   

 116   3                              LED_B=0;                           //≤º∑¿÷∏ æµ∆≥§¡¡£¨◊º±∏ºÏ≤‚»» ÕµÁ–≈∫≈
 117   3                              TIME_50ms=0;               //º∆ ±±‰¡ø«Â¡„
 118   3                              flag_time_start=0;         //Õ£÷πº∆ ±
 119   3                              again=1;                           //πÿ±’“ª∑÷÷”µ»¥˝
 120   3                      }
 121   2              }
 122   1      }
 123          
 124          //∞¥º¸…®√Ë∫Ø ˝
 125          void keyscan()
 126          {
 127   1              if(key1==0&&flag_BF==0)//‘⁄∑«≤º∑¿◊¥Ã¨ ±≤º∑¿∞¥º¸∞¥œ¬
 128   1              {
 129   2                      delay(5);//—” ±»•∂∂
 130   2                      if(key1==0)                //‘Ÿ¥Œ≈–∂œ∞¥º¸ «∑Ò∞¥œ¬
 131   2                      {
 132   3                              LED_B=0;           //µ„¡¡≤º∑¿LEDµ∆
 133   3                              flag=0;            //±‰¡ø«Â¡„
 134   3                              flag_time_start=1;//ø™ ºº∆ ±±‰¡ø÷√“ª
 135   3                      }
 136   2                      while(key1==0);    //∞¥º¸ Õ∑≈
 137   2              }
 138   1              if(flag_time_start==1)  //ø™ ºº∆ ±
 139   1              {
 140   2                      TIME();                         //µ˜”√º∆ ±∫Ø ˝
 141   2              }
 142   1              if(key2==0)                             //≥∑∑¿∞¥º¸∞¥œ¬
 143   1              {                          
 144   2                      delay(5);//—” ±»•∂∂
 145   2                      if(key2==0)                //‘Ÿ¥Œ≈–∂œ∞¥º¸ «∑Ò∞¥œ¬
 146   2                      {
 147   3                              BUZZ=1;                 //πÿ±’∑‰√˘∆˜ 
 148   3                              flag_alam=0;    //±®æØ±‰¡ø«Â¡„
 149   3                              flag_BF=0;              //≤º∑¿±‰¡ø«Â¡„
 150   3                              flag=0;                 //±‰¡ø«Â¡„
 151   3                              flag_time_start=0;//ø™ ºº∆ ±±‰¡ø«Â¡„
 152   3                              LED_S=1;                //πÿ±’∑¢ÀÕ∂Ã–≈÷∏ æµ∆
 153   3                              LED_B=1;                //πÿ±’≤º∑¿÷∏ æµ∆
 154   3                      }
 155   2                      while(key2==0);         //∞¥º¸ Õ∑≈
 156   2              }
 157   1              if(key3==0)                             //ΩÙº±∞¥º¸∞¥œ¬
 158   1              {
 159   2                      delay(5);                       //—” ±»•∂∂
 160   2                      if(key3==0)                     //‘Ÿ¥Œ≈–∂œ∞¥º¸ «∑Ò∞¥œ¬
 161   2                      {
 162   3                              SOS=1;                  // ÷∂Ø∑¢ÀÕ∂Ã–≈±‰¡ø÷√“ª£¨◊º±∏∑¢ÀÕ∂Ã–≈
 163   3                              flag_alam=1;    //±®æØ±‰¡ø÷√“ª
 164   3                      }
 165   2                      while(key3==0);         //∞¥º¸ Õ∑≈
 166   2              }
 167   1      } 
 168          
 169          void GSM_work()                         //∑¢ÀÕGSM∂Ã–≈
 170          {
 171   1              unsigned char send_number;      //∂®“Â∑¢ÀÕ ÷ª˙∫≈µƒ±‰¡ø
 172   1              if(rsd==0&&flag_BF==1)          //≤º∑¿◊¥Ã¨«“»» ÕµÁ”––≈∫≈ ±
 173   1              flag_alam=1;                            //±®æØ±‰¡ø÷√“ª
 174   1      
 175   1              if((rsd==0&&flag_BF==1&&again==1)||SOS==1)//≤º∑¿◊¥Ã¨«“»» ÕµÁ”––≈∫≈ ±«“≤ª‘⁄“ª∑÷÷”µ»¥˝ ±º‰ƒ⁄  ªÚ’ﬂ    ÷∂Ø∞¥
             -œ¬ΩÙº±∞¥º¸
 176   1              {
C51 COMPILER V9.00   MAIN                                                                  03/07/2016 00:05:53 PAGE 4   

 177   2                      LED_S=0;                                                                 //¥Úø™∑¢ÀÕ∂Ã–≈÷∏ æµ∆
 178   2                      BUZZ=1;                                                                  //πÿ±’∑‰√˘∆˜
 179   2                      SendString("AT+CMGF=1\r\n");                     //…Ë÷√Œƒ±æƒ£ Ω
 180   2                      
 181   2                      delay(1000);                                                     //—” ±£¨»√GSMƒ£øÈ”–“ª∏ˆ∑¥”¶ ±º‰
 182   2                      
 183   2                      SendString("AT+CSCS=\"UCS2\"\r\n");              //…Ë÷√∂Ã–≈∏Ò Ω£¨∑¢ÀÕ∫∫◊÷ƒ£ Ω
 184   2                      
 185   2                      delay(1000);                                                     //—” ±
 186   2                      
 187   2                      SendString("AT+CSMP=17,0,2,25\r\n");     //…Ë÷√∂Ã–≈Œƒ±æƒ£ Ω≤Œ ˝£®æﬂÃÂƒ⁄»›≤Œøºø™∑¢◊ ¡œƒ⁄µƒƒ£øÈ◊ ¡œ£©
 188   2                      
 189   2                      delay(1000);                                                     //—” ±
 190   2                      
 191   2                      SendString("AT+CMGS="); //–≈œ¢∑¢ÀÕ÷∏¡Ó AT+CMGS=//
 192   2                      SendASC('"');                                                                    //“˝∫≈
 193   2                      for(send_number=0;send_number<11;send_number++)  //‘⁄√øŒª∫≈¬Î«∞º”003
 194   2                      {
 195   3                              SendASC('0');
 196   3                              SendASC('0');
 197   3                              SendASC('3');
 198   3                              SendASC(PhoneNO[send_number]);                           //Ω” ’ ÷ª˙∫≈¬Î
 199   3                      }     
 200   2                      SendASC('"');                                                                   //“˝∫≈
 201   2                      SendASC('\r');                  //∑¢ÀÕªÿ≥µ÷∏¡Ó//
 202   2                      SendASC('\n');                  //∑¢ÀÕªª––÷∏¡Ó//
 203   2                      
 204   2                      delay(1000);                            //—” ±
 205   2      
 206   2                      SendString(somebody);           //∑¢ÀÕ∂Ã–≈ƒ⁄»›
 207   2              
 208   2                      delay(1000);                            //—” ±
 209   2                      
 210   2                      SendASC(0x1a);                          //»∑∂®∑¢ÀÕ∂Ã–≈
 211   2                      
 212   2                      if(SOS==0)                                      //≤ª «ΩÙº±∞¥º¸∑¢ÀÕ∂Ã–≈
 213   2                      {
 214   3                              again=0;                                //again«Â¡„£¨“≤æÕ «Ω¯»Î“ª∑÷÷”µ»¥˝£¨µ±º∆ ±µΩ“ª∑÷÷”∫Û£¨∏√±‰¡ø÷ÿ–¬÷√“ª
 215   3                              flag_time_start=1;              //ø™ ºº∆ ±
 216   3                              flag_alam=1;                    //±®æØ
 217   3                      }
 218   2                      else if(SOS==1&&flag_time_start==1)      //ΩÙº±∞¥º¸∑¢ÀÕ∂Ã–≈∫Û
 219   2                      {                                                                                         
 220   3                              TIME_50ms=0;                                     //º∆ ± ˝æ›«Â¡„
 221   3                              flag_BF=1;                                               //≤º∑¿±‰¡ø÷√“ª
 222   3                              LED_B=0;                                                 //µ„¡¡≤º∑¿÷∏ æµ∆
 223   3                              flag_time_start=0;                               //Õ£÷πº∆ ±
 224   3                              again=1;                                                 //≤ªΩ¯»Î“ª∑÷÷”µ»¥˝
 225   3                      }
 226   2                      
 227   2                      LED_S=1;                                                         //œ®√∑¢ÀÕ∂Ã–≈÷∏ æµ∆
 228   2                      SOS=0;                                                           //ΩÙº±±‰¡ø«Â¡„
 229   2                      flag=1;                                                          //±‰¡ø÷√“ª
 230   2              }
 231   1      }       
 232          void main()                                                                      //÷˜∫Ø ˝
 233          {       
 234   1              Uart_init();                                                     //µ˜”√÷–∂œ≥ı ºªØ∫Ø ˝
 235   1              while(1)                                                                 //Ω¯»Îwhile—≠ª∑
 236   1              {
 237   2                      keyscan();                                                       //∞¥º¸∫Ø ˝
 238   2                      GSM_work();                                                      //∑¢ÀÕ∂Ã–≈∫Ø ˝
C51 COMPILER V9.00   MAIN                                                                  03/07/2016 00:05:53 PAGE 5   

 239   2              }         
 240   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    491    ----
   CONSTANT SIZE    =    123    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      8    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
